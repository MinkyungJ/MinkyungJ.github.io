---
title: Deploy Strategy
tags: [DevOps, Deploy Strategy, Zero-downtime Deployment]
date: 2023-07-24 18:00 +0900
categories: [DevOps, Zero-downtime Deployment]
toc: true
---

# ❗️ 무중단 배포란?

> - 간단하게 시스템의 가동 중단을 최소화하는 개발 및 운영 방식을 의미합니다.
> - 실시간 모니터링 및 롤백 기능을 갖추고 있어, 배포 중 장애가 발생하면 자동으로 이전 안정적인 버전으로 롤백합니다.
> - 무중단 배포는 소프트웨어 개발과 인프라 관리를 자동화하여 새로운 변경 사항을 신속하게 테스트, 빌드, 배포하는 것을 목표로 합니다.

---

## ❗️ 서비스는 언제 중단될까요?

![Continuous Deploy](https://github.com/MinkyungJ/MinkyungJ.github.io/blob/main/_posts/Continuous_Deploy.png?raw=true)

V1 서비스를 종료 시키는 시점부터 V2 서비스를 실행하기 전까지는 서비스가 중단된다.
이렇게 서비스가 중단되는 시간을 **다운타임(Downtime)** 이라고 한다.

> V2 서비스를 시작하는데 꼭 V1를 종료시켜야 하나요?
> - 각 서비스가 동일한 포트를 사용한다면 당연히 종료시켜야한다.
> - 따라서 다운타임을 최소화하기 위해 무중단 배포가 필요합니다.

---

## ❗️ 롤링 배포 (Rolling Deployment)

> 일반적인 배포를 의미하며, 단순하게 서버를 구성하여 배포하는 전략으로 구 버전에서 신 버전으로 트래픽을 **점진적으로** 전환하는 배포 전략입니다.
> - 가용 자원이 제한적일 경우에 사용됨

#### 롤링 배포의 방식

![Rolling Deployment](https://github.com/MinkyungJ/MinkyungJ.github.io/blob/main/_posts/Rolling_Deployment.png?raw=true)
- 사용 중인 인스턴스(V1)내에서 새 버전(V2)을 점진적으로 교체합니다.

#### 롤링 배포의 장점

- Downtime이 없습니다.
- 관리하기 간편합니다.

#### 롤링 배포의 단점

- 배포 중 한 쪽의 인스턴스 수가 감소하므로 서버 처리 용량을 미리 고려해야 합니다.
- 배포가 진행되는 동안 구,신버전이 공존하기 때문에 호환성 문제가 발생할 수 있습니다.

> 간단하게, 롤링 배포는 점진적으로 새 버전으로 전환하면서 서비스가 중단되지 않도록 보장하는 방법입니다.

---

## ❗️ 블루-그린 배포 (Blue-Green Deployment)

> 구 버전을 의미하는 **블루**와 신 버전을 의미하는 **그린**을 동시에 구성하고, 배포 시점에서 로드밸런서를 통해 트래픽을 구에서 신버전으로 **일제히** 전환 시키는 방식을 의미합니다.

#### 블루-그린 배포의 방식

![Blue-Green Deployment](https://github.com/MinkyungJ/MinkyungJ.github.io/blob/main/_posts/Blue_Green_Deployment.png?raw=true)
- 운영중인 구버전과 동일하게 신버전의 인스턴스를 구성한 후 로드밸런서를 통해 모든 트래픽을 한번에 신버전 쪽으로 전환합니다.
  - 새로운 버전을 릴리스 하고 싶은 경우에는 Green 환경에서 테스트를 진행합니다.
  - 테스트가 정상적으로 완료되었다면, Blue 환경으로 들어가던 모든 요청을 Green 환경으로 전환합니다.
  - 이후의 Blue 환경은 Green이 잘 동작하지 않을 경우에 사용 가능한 백업 서버로의 역할도 수행할 수 있습니다.

#### 블루-그린 배포의 원칙

- 두 환경은 다르지만, 최대한 동일해야 합니다.
- 무중단 배포여야만 합니다.
- 한 시점에 하나의 버전만 Active한 상태여야 하며, 롤백이 용이해야합니다.

#### 블루-그린 배포의 장점

- 서비스의 가동 중단 시기를 최소화시킬 수 있습니다.
- 운영 환경에 영향을 주지 않고 실제 서비스 환경에서 신 버전 테스트를 진행할 수 있습니다.
- 구 버전의 인스턴스로 빠르고 쉽게 롤백할 수 있으며, 구 버전의 환경을 다음 배포에 사용할 수 있습니다.

#### 블루-그린 배포의 단점

- 시스템 리소스가 두배로 필요하여 비용이 더 많이 발생합니다.
- 새로운 환경에 대한 테스트가 전제되어야합니다.

> 간단하게, 블루-그린 배포는 완전히 새로운 환경에서 트래픽을 전환하여 롤백을 용이하게 하는 방법입니다.

---

## ❗️ 카나리 배포 (Canary Deployment)

> 전체 인프라에 새로운 소프트웨어 버전을 릴리스하여, 모든 사용자가 사용할 수 있도록 하기 전에 변경 사항을 천천히 릴리스하여 단계적으로 전환하는 방식을 의미합니다.

#### 카나리 배포의 방식

![Canary Deployment](https://github.com/MinkyungJ/MinkyungJ.github.io/blob/main/_posts/Canary_Deployment.png?raw=true)
- 특정 서버에만 배포를 진행해 오류 여부를 확인한 뒤에 오류가 없다면, 모든 서버에 신 버전을 단계적으로 배포합니다.

#### 카나리 배포의 장점

- 운영 버전에서 특정 서버로 신 버전을 테스트 할 수 있습니다.
- 배포를 진행하고 문제가 발생할 시, 먼저 배포가 진행되었던 서버만 롤백하면 되므로 롤백이 간편하며 리스크가 적습니다.
- 부정적인 영향을 최소화하고 상황에 따라 트래픽 양을 조절하며 롤백할 수 있습니다.

#### 카나리 배포의 단점

- 롤링 배포에 비해 복잡합니다.
- 서버가 점진적으로 꺼졌다가 실행되기 때문에, 남은 서버가 네트워크의 트래픽을 제어하는 것이 부담됩니다.

> 간단하게, 위험을 빠르게 감지할 수 있는 배포를 의미하며, 지정된 서버나 특정 사용자에게만 배포했다가 문제가 없으면 전체적으로 배포하는 방식입니다.

| 배포 전략 |                                        롤링                                       |                                                          블루그린                                                         |                                            카나리                                            |
|:---------:|:---------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------:|:--------------------------------------------------------------------------------------------:|
| 장점      | - 다운타임 X<br>- 점진적 배포 가능<br>- 추가적인 리소스 필요 X<br>- 간편한 관리   | - 다운타임 최소화 가능<br>- 간편한 롤백<br>- Green 환경에서 테스트 가능                                                   | - 점진적 배포 가능<br>- 실시간 트래픽 모니터링 가능<br>- 간편한 롤백<br>- 적은 리스크의 배포 |
| 단점      | - 어려운 롤백<br>- 인프라 갯수에 따라 길어지는 배포 시간<br>- 처리 용량 고려 필요 | - 롤링 배포에 비해 복잡<br>- 리소스가 두배로 필요하며 비용도 더 많이 발생함<br>- 새로운 환경에 대한 테스트가 전제되어야함 | - 롤링 배포에 비해 복잡<br>- 트래픽 제어의 부담                                              |